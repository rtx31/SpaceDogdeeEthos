<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Space Dodger — Game Sederhana</title>
  <style>
    html,body{height:100%;margin:0;background:#071026;color:#fff;font-family:system-ui;}
    #game{display:block;width:100%;height:100vh;touch-action:none;background:linear-gradient(#071026,#0b1b2b);}
    .ui{position:fixed;left:10px;top:10px;font-size:16px;background:rgba(0,0,0,0.3);padding:8px;border-radius:8px;}
    .center{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;}
    button{padding:10px 14px;border:none;border-radius:8px;background:#1fb6ff;color:#022;font-weight:600;}
    footer{position:fixed;bottom:5px;left:5px;font-size:12px;color:rgba(255,255,255,0.6);}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div class="ui" id="score">Score: 0</div>
  <div class="center" id="overlay" style="display:none;">
    <h1 id="title">Game Over</h1>
    <p id="finalScore">Score: 0</p>
    <button id="restart">Main Lagi</button>
  </div>
  <audio id="bgm" src="space-ambient.mp3" loop></audio>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let player, obstacles, score, playing, moveX, keys, lastTime, spawnInterval, lastSpawn;

function resize(){canvas.width=innerWidth; canvas.height=innerHeight;}
addEventListener('resize', resize);
resize();

function initGame(){
  player = { x:canvas.width/2 - 18, y:canvas.height - 60, w:36, h:36 };
  obstacles = [];
  score = 0; playing = true;
  moveX = player.x;
  keys = {};
  spawnInterval = 900;
  lastSpawn = performance.now();
  lastTime = performance.now();
  document.getElementById('score').textContent = 'Score: 0';
  document.getElementById('overlay').style.display = 'none';
}

function spawn(){
  const size = 20 + Math.random()*36;
  obstacles.push({ x:Math.random()*(canvas.width-size), y:-size, w:size, h:size, speed:2.5 + Math.random()*3 });
}

function loop(now){
  const dt = now - lastTime;
  lastTime = now;
  if(!playing) return;

  if(now - lastSpawn > spawnInterval){ spawn(); lastSpawn = now; }

  if(keys.ArrowLeft||keys.a) moveX -= 8;
  if(keys.ArrowRight||keys.d) moveX += 8;
  player.x += (moveX - player.x)*0.2;
  player.x = Math.max(0, Math.min(canvas.width-player.w, player.x));

  obstacles.forEach(o => { o.y += o.speed; });
  obstacles = obstacles.filter(o => {
    if(o.y > canvas.height){ score++; document.getElementById('score').textContent = 'Score: '+score; return false; }
    if(o.x < player.x + player.w && o.x + o.w > player.x && o.y + o.h > player.y){ playing = false; showGameOver(); }
    return true;
  });

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#1fb6ff'; ctx.beginPath();
  ctx.moveTo(player.x+player.w/2, player.y);
  ctx.lineTo(player.x, player.y+player.h);
  ctx.lineTo(player.x+player.w, player.y+player.h);
  ctx.closePath(); ctx.fill();

  ctx.fillStyle='#c94f1b'; ctx.shadowColor='rgba(0,0,0,0.5)'; ctx.shadowBlur=8;
  obstacles.forEach(o => {
    ctx.beginPath();
    ctx.arc(o.x+o.w/2, o.y+o.h/2, o.w/2,0,Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;
  });

  requestAnimationFrame(loop);
}

function showGameOver(){
  document.getElementById('overlay').style.display='block';
  document.getElementById('finalScore').textContent='Score: '+score;
}

addEventListener('keydown', e=>keys[e.key]=true);
addEventListener('keyup', e=>keys[e.key]=false);
addEventListener('pointerdown', e=>moveX = e.clientX);
addEventListener('pointermove', e=>{ if(e.buttons) moveX = e.clientX; });

document.getElementById('restart').onclick = () => {
  initGame(); requestAnimationFrame(loop);
  playBGM();
};

const bgm = document.getElementById('bgm');
bgm.volume = 0.4;
function playBGM(){ bgm.play().catch(_=>{}); }
window.addEventListener('click', playBGM, { once: true });

initGame();
requestAnimationFrame(loop);
</script>

<footer>
  BGM: "Space Ambient" oleh DELOSound (Pixabay) — Royalty-free
</footer>
</body>
</html>
